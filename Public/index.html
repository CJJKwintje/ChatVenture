<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatVenture - Inspiratie voor jouw volgende avontuur!</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<script>
  function startNewSearch() {
  document.getElementById('response-output').classList.add('hidden');
  document.getElementById('response-title').classList.add('hidden');
  document.getElementById('new-search-button').classList.add('hidden');
  document.getElementById('input-fields').classList.remove('hidden');

  function fetchWithTimeout(resource, options) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), options.timeout || 8000); // Stel een default timeout in, of gebruik de waarde uit options

  return fetch(resource, {
    ...options,
    signal: controller.signal
  }).then(response => {
    clearTimeout(timeoutId);
    return response;
  }).catch(error => {
    clearTimeout(timeoutId);
    throw error;
  });
}
}
async function submitPrompt() {
  // Toon de loader en verberg de invoervelden, response titel en vorige response
  document.getElementById('input-fields').classList.add('hidden');
  document.getElementById('loader').classList.remove('hidden');
  document.getElementById('response-title').classList.add('hidden');
  document.getElementById('response-output').classList.add('hidden');
  document.getElementById('response-output').textContent = '';

  // The endpoint for your Netlify serverless function
  const apiEndpoint = '/.netlify/functions/chat';

  // Vertreklocatie
  const vertreklocatie = document.getElementById('vertreklocatie').value;

  // Type vakantie
  const typeVakantie = document.getElementById('type-vakantie-select').value;
  
   // Voorkeursgebied
  const selectedRadio = document.querySelector('input[name="gebied-select"]:checked');
  
  // Check of er een radio-button is geselecteerd
  if (!selectedRadio) {
    console.error('Geen gebied geselecteerd');
    return; // Stop de functie als er niets is geselecteerd
  }
  const selectedImageValue = selectedRadio.value;
  const extraVoorkeuren = document.getElementById('textarea-voorkeuren').value;

  // Set up the data to send, including the messages array
  const postData = {
messages: [
      {
        role: "system",
        content: `Gedraag je als een enthousiaste travelagent. De gebruiker gaat 4 vragen beantwoorden, namelijk "wat is je vertrek locatie?" "Naar wat voor type vakantie ben je op zoek?", "Naar welk gebied zou je willen gaan?" En "Wat vind je verder belangrijk voor je volgende vakantie?". Zorg ervoor dat je een waardevol en heel kort advies geeft op basis van de 4 antwoorden die je gaat formuleren op deze vragen.`
      },
      {
        role: "user",
        content: `Vertreklocatie: ${vertreklocatie}, Type vakantie: ${typeVakantie}, Gebied: ${selectedImageValue}, Belangrijk: ${extraVoorkeuren}`

      }
    ]
  };

  // Set up the options for the fetch request
  const requestOptions = {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(postData)
  };

   try {
  // Make the API request to your Netlify function with a timeout
  const response = await fetchWithTimeout(apiEndpoint, requestOptions, 20000); // 20 seconden timeout

  // Hieronder volgt je bestaande code om de response te verwerken
  if (!response.ok) {
    throw new Error(`Network response was not ok: ${response.statusText}`);
    }
    const contentType = response.headers.get('content-type');
    if (!contentType || !contentType.includes('application/json')) {
      throw new TypeError("Oops, we haven't got JSON!");
    }

    const data = await response.json();

    // Check if the response from the Netlify function (OpenAI API) has a 'choices' array
    if (data.choices && data.choices.length > 0) {
      // Toon de response titel en output
      document.getElementById('response-title').classList.remove('hidden');
      document.getElementById('response-output').classList.remove('hidden');
      document.getElementById('response-output').textContent = data.choices[0].message.content;
      document.getElementById('new-search-button').classList.remove('hidden');
    } else {
      // Als er geen 'choices' array is, toon dan een foutmelding
      document.getElementById('response-output').classList.remove('hidden');
      document.getElementById('response-output').textContent = 'No response from API.';
    }
  } catch (error) {
    // If there is an error, display it in the response output
    document.getElementById('response-output').classList.remove('hidden');
    document.getElementById('response-output').textContent = error.message;
  } finally {
    // Hide the loader once the request is completed
    document.getElementById('loader').classList.add('hidden');
  }
}
</script>
</head>
<body>

<h1>Waar gaat jouw volgende vakantie naartoe?</h1>
<div class="container">
<div id="input-fields">
<div class="locatie">
<label for="vertreklocatie">Wat is je vertreklocatie?</label>
  <input type="text" id="vertreklocatie" name="locatie" placeholder="Bijv. Amsterdam">
  </div> 
<!-- Dropdown voor het type vakantie -->
<div class="Vakantie-dropdown">
<label for="type-vakantie-select">Naar wat voor type vakantie ben je op zoek?</label>
<select id="type-vakantie-select">
  <option value="Geen voorkeur">-</option>
  <option value="Stedentrip">Stedentrip</option>
  <option value="Reis voor langere periode">Reis voor langere periode</option>
  <option value="Zomervakantie">Zomervakantie</option>
  <option value="Wintersport">Wintersport</option>
  <option value="Dagje weg">Dagje weg</option>
</select>
</div>

<!-- Kies een gebied door het klikken van een plaatje -->

<div class="image-selection">
  <h3>Naar welk gebied zou je willen gaan?</h3>
  <label for="gebied1">
    <input type="radio" name="gebied-select" id="gebied1" value="Europa">
    <img src="images/europe.png" alt="Europa">
    <figcaption>Europa</figcaption>
  </label>
  
  <label for="gebied2">
    <input type="radio" name="gebied-select" id="gebied2" value="Afrika">
    <img src="images/africa.png" alt="Afrika">
    <figcaption>Afrika</figcaption>
  </label>

  <label for="gebied3">
    <input type="radio" name="gebied-select" id="gebied3" value="Azië">
    <img src="images/asia.png" alt="Azië">
    <figcaption>Azië</figcaption>
    
  </label>
</div>

<!-- Tekstveld voor extra voorkeuren -->
<div class="extra-voorkeuren">
<label for="textarea-voorkeuren">Wat vind je verder belangrijk voor je volgende vakantie?</label>
<textarea id="textarea-voorkeuren" name="extra-voorkeuren" rows="4" cols="50" placeholder="Bijv. Ik neem graag mijn hond mee op vakantie"></textarea>
</div>
<!-- Knop om de gegevens te verzenden -->
<button onclick="submitPrompt()">Inspireer me!</button>
</div>
<!-- Loader -->
<div id="loader" class="hidden"></div>

<!-- Gebied om de respons weer te geven -->
<!-- Verborgen gebied voor de response, die later zichtbaar gemaakt zal worden -->
<h2 id="response-title" class="hidden">Jouw reisadvies op maat:</h2>
<div id="response-output" class="hidden" style="white-space: pre-wrap;"></div>
<button id="new-search-button" class="hidden" onclick="startNewSearch()">Terug</button>
</div>

</body>

</html>
